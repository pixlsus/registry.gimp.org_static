<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN"
  "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" version="XHTML+RDFa 1.0" dir="ltr">

<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../files/favicon.png" type="image/png" />
<link rel="alternate" type="application/rss+xml" title="Comments for &quot;How to get average color within a selection island.&quot;" href="../crss/node/24376" />
<link rel="canonical" href="24376.html" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
<link rel="shortlink" href="24376.html" />
  <title>How to get average color within a selection island. | GIMP Plugin Registry</title>
  <style type="text/css" media="all">@import url("../modules/system/system.base.css?n48fl6");
@import url("../modules/system/system.menus.css?n48fl6");
@import url("../modules/system/system.messages.css?n48fl6");
@import url("../modules/system/system.theme.css?n48fl6");</style>
<style type="text/css" media="all">@import url("../modules/aggregator/aggregator.css?n48fl6");
@import url("../modules/book/book.css?n48fl6");
@import url("../modules/comment/comment.css?n48fl6");
@import url("../sites/all/modules/date/date_api/date.css?n48fl6");
@import url("../sites/all/modules/date/date_popup/themes/datepicker.1.7.css?n48fl6");
@import url("../sites/all/modules/date/date_repeat_field/date_repeat_field.css?n48fl6");
@import url("../modules/field/theme/field.css?n48fl6");
@import url("../sites/all/modules/mollom/mollom.css?n48fl6");
@import url("../modules/node/node.css?n48fl6");
@import url("../modules/poll/poll.css?n48fl6");
@import url("../modules/search/search.css?n48fl6");
@import url("../modules/user/user.css?n48fl6");
@import url("../modules/forum/forum.css?n48fl6");
@import url("../sites/all/modules/views/css/views.css?n48fl6");</style>
<style type="text/css" media="all">@import url("../sites/all/modules/ctools/css/ctools.css?n48fl6");
@import url("../sites/all/modules/rate/rate.css?n48fl6");
@import url("../sites/all/modules/tagclouds/tagclouds.css?n48fl6");
@import url("../sites/all/modules/panels/css/panels.css?n48fl6");
@import url("../sites/all/modules/best_answer/best_answer.css?n48fl6");</style>
<style type="text/css" media="all">@import url("../files/color/garland-5ac73a91/style.css?n48fl6");</style>
<style type="text/css" media="print">@import url("../themes/garland/print.css?n48fl6");</style>

<!--[if lt IE 7]>
<link type="text/css" rel="stylesheet" href="http://registry.gimp.org/themes/garland/fix-ie.css?n48fl6" media="all" />
<![endif]-->
  <script type="text/javascript" src="../misc/jquery.js?v=1.4.4"></script>
<script type="text/javascript" src="../misc/jquery.once.js?v=1.2"></script>
<script type="text/javascript" src="../misc/drupal.js?n48fl6"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"garland","theme_token":"QXYxsI4ZmZYEoJ6JuYs7uV7PxwFTDJnT2uRq9E1ArqA","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/aggregator\/aggregator.css":1,"modules\/book\/book.css":1,"modules\/comment\/comment.css":1,"sites\/all\/modules\/date\/date_api\/date.css":1,"sites\/all\/modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"sites\/all\/modules\/date\/date_repeat_field\/date_repeat_field.css":1,"modules\/field\/theme\/field.css":1,"sites\/all\/modules\/mollom\/mollom.css":1,"modules\/node\/node.css":1,"modules\/poll\/poll.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"modules\/forum\/forum.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"sites\/all\/modules\/rate\/rate.css":1,"sites\/all\/modules\/tagclouds\/tagclouds.css":1,"sites\/all\/modules\/panels\/css\/panels.css":1,"sites\/all\/modules\/best_answer\/best_answer.css":1,"themes\/garland\/style.css":1,"themes\/garland\/print.css":1,"themes\/garland\/fix-ie.css":1}}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in two-sidebars page-node page-node- page-node-24376 node-type-forum fluid-width" >
  <div id="skip-link">
    <a href="24376#main-content.html" class="element-invisible element-focusable">Skip to main content</a>
  </div>
      
  <div id="wrapper">
    <div id="container" class="clearfix">

      <div id="header">
        <div id="logo-floater">
                              <div id="branding"><strong><a href="../index.html">
                          <img src="../files/logo.png" alt="GIMP Plugin Registry " title="GIMP Plugin Registry " id="logo" />
                        <span>GIMP Plugin Registry</span>            </a></strong></div>
                          </div>

        <h2 class="element-invisible">Main menu</h2><ul class="links inline main-menu"><li class="menu-100 first"><a href="../about" title="Information about the Registry">About</a></li>
<li class="menu-136"><a href="23851.html" title="Documentation and How-Tos">Documentation</a></li>
<li class="menu-88"><a href="../forum">Forums</a></li>
<li class="menu-74"><a href="http://gug.criticalhit.dk" title="The GIMP User Group">GIMP User Group</a></li>
<li class="menu-1142"><a href="25574.html" title="GIMP Help">Get Help</a></li>
<li class="menu-1256"><a href="26216.html" title="Get info on using RSS to stay updated about what&#039;s going on on the site.">Stay Updated!</a></li>
<li class="menu-73 last"><a href="http://www.gimp.org/" title="The GIMP Homepage">gimp.org</a></li>
</ul>              </div> <!-- /#header -->

              <div id="sidebar-first" class="sidebar">
            <div class="region region-sidebar-first">
    <div id="block-system-navigation" class="block block-system block-menu clearfix">

    <h2 class="title">Navigation</h2>
  
  <div class="content">
    <ul class="menu"><li class="first leaf"><a href="25574.html" title="FAQ &amp; How To&#039;s">FAQ &amp; How To&#039;s</a></li>
<li class="leaf"><a href="../glossary/1.html" title="">Content By Name</a></li>
<li class="collapsed"><a href="../aggregator">Feed aggregator</a></li>
<li class="leaf"><a href="../popular">Popular content</a></li>
<li class="leaf"><a href="25392.html" title="Report Spam Here">Report Spam Here</a></li>
<li class="last leaf"><a href="../tagclouds">Tags</a></li>
</ul>  </div>
</div>
<div id="block-block-1" class="block block-block clearfix">

    
  <div class="content">
    If you'd like to upload plug-ins, please create an account below. You do <em>not</em> need one for download. Enjoy :-)  </div>
</div>
<div id="block-user-login" class="block block-user clearfix">

    <h2 class="title">User login</h2>
  
  <div class="content">
    <form action="http://registry.gimp.org/node/24376?destination=node/24376" method="post" id="user-login-form" accept-charset="UTF-8"><div><div class="form-item form-type-textfield form-item-name">
  <label for="edit-name">Username <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" id="edit-name" name="name" value="" size="15" maxlength="60" class="form-text required" />
</div>
<div class="form-item form-type-password form-item-pass">
  <label for="edit-pass">Password <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" id="edit-pass" name="pass" size="15" maxlength="128" class="form-text required" />
</div>
<div class="item-list"><ul><li class="first last"><a href="../user/password" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" value="form-zuGVKvhC01bgYBPjPO3vzb0lLnp1zUMbwmRBXrt-57Y" />
<input type="hidden" name="form_id" value="user_login_block" />
<div class="form-actions form-wrapper" id="edit-actions"><input type="submit" id="edit-submit" name="op" value="Log in" class="form-submit" /></div></div></form>  </div>
</div>
<div id="block-node-syndicate" class="block block-node clearfix">

    <h2 class="title">Syndicate</h2>
  
  <div class="content">
    <a href="../rss.xml" class="feed-icon" title="Subscribe to Syndicate"><img src="../misc/feed.png" width="16" height="16" alt="Subscribe to Syndicate" /></a>  </div>
</div>
  </div>
        </div>
      
      <div id="center"><div id="squeeze"><div class="right-corner"><div class="left-corner">
          <h2 class="element-invisible">You are here</h2><div class="breadcrumb"><a href="../index.html">Home</a> › <a href="../forum">Forums</a> › <a href="../forum/26">Help</a></div>                    <a id="main-content"></a>
          <div id="tabs-wrapper" class="clearfix">                                <h1 class="with-tabs">How to get average color within a selection island.</h1>
                              </div>                                                  <div class="clearfix">
              <div class="region region-content">
    <div id="block-system-main" class="block block-system clearfix">

    
  <div class="content">
    <div id="node-24376" class="node node-forum">

  
      
      <span class="submitted">April 21, 2010 - 22:24 — <span class="username">lylejk</span></span>
  
  <div class="content clearfix">
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even"><p>Please see link for more details (<a href="http://www.gimptalk.com/forum/how-to-get-average-color-within-a-selection-island--t48488.html">http://www.gimptalk.com/forum/how-to-get-average-color-within-a-selectio...</a>), but basically, if I have multiple selection islands, I would like to create fills for those islands based on the average color within each selection island.  If just select and blur (large), you just get a single color.  That's not what I want.   Hopefully someone here (RobA?) can help me.   :)</p>
</div></div></div><div class="field field-name-taxonomy-forums field-type-taxonomy-term-reference field-label-above"><div class="field-label">Forums:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="../forum/26">Help</a></div></div></div>  </div>

  <div class="clearfix">
          <div class="links"><ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>
    
    <div id="comments" class="comment-wrapper">
  
  
  <a id="comment-7791"></a>
<div class="comment odd">

  <div class="clearfix">

    <span class="submitted">April 22, 2010 - 15:16 — <span class="username">bootchk</span></span>

  
  
        <h3><a href="../comment/7791#comment-7791" class="permalink" rel="bookmark">selection islands</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>More generally, you want to apply a filter to each island (component that is a closed region) of a selection separately?  You want to fill one island with its average color, the next island with its average color, ...?</p>
<p>The Gimp library doesn't appear to have a way to access components of the selection.</p>
<p>I think it could be done by converting the selection to a path, then accessing components of the path (which are strokes?)  For each stroke (that is closed), create a new path from the stroke, create a new selection from the path, apply the filter.  End by restoring the original selection.</p>
<p>It might be slow, but that doesn't matter.</p>
<p>The details might be devilish.  For example, would a selection component at the edge of the image return a closed stroke?  Does the Gimp library tell you whether a stroke is closed?</p>
</div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>

<div class="indented"><a id="comment-7792"></a>
<div class="comment comment-by-node-author even">

  <div class="clearfix">

    <span class="submitted">April 22, 2010 - 15:51 — <span class="username">lylejk</span></span>

  
  
        <h3><a href="../comment/7792#comment-7792" class="permalink" rel="bookmark">Yes, it is a slow process,</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Yes, it is a slow process, but Saul created a cool Script-fu for me at GIMPTalk (for some reason, I get spam filter trigger when I link again; see link in first thread).  The no save history version is about 3 times faster (at least on my machine).   :)</p>
</div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>
<a id="comment-7795"></a>
<div class="comment odd">

  <div class="clearfix">

    <span class="submitted">April 23, 2010 - 16:39 — <span class="username">bootchk</span></span>

  
  
        <h3><a href="../comment/7795#comment-7795" class="permalink" rel="bookmark">apply to selection islands</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>I began another way to do this.  For now, it is a draft that so far, seems to work.  It needs more work and testing.  For example, it leaves the progress bar weird.  When I have more time....</p>
<p>#!/usr/bin/env python</p>
<p>'''<br />
 Test apply filter to selection parts</p>
<p> Apply a filter to selection parts.<br />
 This might be used when a filter would treat each selection part differently<br />
 because of the content or context of the selection part.<br />
 If a filter output does not depend on the selection,<br />
 e.g. a filter that renders, creates new content, de novo, from scratch ....,<br />
 then don't use this plugin, instead filter the entire selection.</p>
<p> In computer programming 'apply a function' means 'iteratively invoke' on say a list.<br />
 Which is what this does.<br />
 In computer GUI design, an 'Apply' button means 'do it.'<br />
 But for the general public, use the long 'Apply filter to selection parts'<br />
 to say more clearly what will happen.</p>
<p> Test cases:<br />
  doesn't alter existing paths<br />
  doesn't alter the selection<br />
  doesn't alter the context<br />
  doesn't alter layers or channels<br />
'''</p>
<p>'''<br />
Notes about types and terminology.<br />
This can be very confusing.<br />
The below might not be correct:  probably a PDB stroke is a SVG polygon.</p>
<p>These contexts of discussion:<br />
Gimp user<br />
PDB type<br />
SVG<br />
Pygimp type<br />
this program</p>
<p>Gimp    PDB       PDB type  SVG       Pygimp type    this program</p>
<p>Path    vectors   VECTORS   file?     vector object  a set of strokes<br />
NA      strokes   int array NA        tuple          a sequence of stroke items<br />
NA      stroke    int       polyline  int (position) a set of lines<br />
NA      NA        NA        polygon   NA             a closed set of connected lines</p>
<p>'''</p>
<p>from gimpfu import * </p>
<p>def apply_filter_to_stroke(image, drawable, vectors, stroke):<br />
  '''<br />
  For the given stroke of the given vectors, apply filter to a selection made from stroke.</p>
<p>  Doesn't appear to be a gimp_vectors_add_stroke().<br />
  There is gimp_vectors_stroke_new_from_points but is only a bezier (for now.)<br />
  So we can't use the strategy: add current stroke to a new vectors.<br />
  (See a draft of that strategy below.)</p>
<p>  Instead, we remove all but the current stroke from a copy of vectors.<br />
  '''<br />
  workingvectors = gimp.pdb.gimp_vectors_copy(vectors)<br />
  gimp.pdb.gimp_image_add_vectors(image, workingvectors, -1)<br />
  count, strokes = gimp.pdb.gimp_vectors_get_strokes(workingvectors)<br />
  # Remove all but the given stroke.<br />
  # !!! Note these are stroke positions, we assume they remain constant among copies.<br />
  for strokecopy in strokes:<br />
    if not strokecopy == stroke:<br />
      print "Removing stroke", strokecopy<br />
      gimp.pdb.gimp_vectors_remove_stroke(workingvectors, strokecopy)<br />
  # assert workingvectors now has one stroke<br />
  gimp.pdb.gimp_selection_none(image)<br />
  gimp.pdb.gimp_vectors_to_selection(workingvectors, CHANNEL_OP_ADD, True, True, 2, 2)<br />
  # Apply filter to this component of the original selection<br />
  gimp.pdb.gimp_edit_fill(drawable, FOREGROUND_FILL)<br />
  gimp.pdb.gimp_image_remove_vectors(image, workingvectors)</p>
<p>  '''<br />
  This is a draft of another strategy, but nonworking.<br />
  workingvectors = gimp.pdb.gimp_vectors_new(image, 'working')<br />
  gimp.pdb.gimp_image_add_vectors(workingvectors)<br />
  gimp.pdb.gimp_vectors_add_stroke(workingvectors, stroke)<br />
  gimp.pdb.gimp_selection_none(image)<br />
  gimp.pdb.gimp_vectors_to_selection(workingvectors, CHANNEL_OP_ADD, True, True, 2, 2)<br />
  # Apply filter to this component of the original selection<br />
  gimp.pdb.gimp_edit_fill(drawable, FOREGROUND_FILL)<br />
  gimp.pdb.gimp_image_remove_vectors(image, workingvectors)<br />
  '''</p>
<p>def plugin_main(image, drawable):</p>
<p>  savedselection = gimp.pdb.gimp_selection_save(image) # save the original selection</p>
<p>  gimp.pdb.plug_in_sel2path(image, drawable, run_mode=RUN_NONINTERACTIVE)<br />
  # Note the new path is now active, but there might be other paths</p>
<p>  '''<br />
  count, vectors = gimp.pdb.gimp_image_get_vectors(image)<br />
  Returns a tuple of integer ID's, not vector objects.<br />
  There is no PDB proc to get a vector object by ID ???<br />
  '''</p>
<p>  vectors = gimp.pdb.gimp_image_get_active_vectors(image)<br />
  # print vectors, type(vectors)<br />
  # vectors is a single object.  Not a Python list, not iterable.</p>
<p>  count, strokes = gimp.pdb.gimp_vectors_get_strokes(vectors)<br />
  # strokes is a tuple of items of type "stroke positions" i.e. integers<br />
  # A stroke is a list of lines, connected in the graph theory sense (shared end points) ??<br />
  # Here, I assume a stroke from a path from a selection is closed in the graph theory sense.<br />
  # TBD test whether any strokes  are NOT closed.<br />
  print "Strokes", strokes, type(strokes)<br />
  for stroke in strokes:<br />
    print stroke, type(stroke)<br />
    apply_filter_to_stroke(image, drawable, vectors, stroke)</p>
<p>  # Cleanup<br />
  gimp.pdb.gimp_image_remove_vectors(image, vectors) # Remove path we created from selection<br />
  gimp.pdb.gimp_selection_load(savedselection) # restore the original selection</p>
<p>register(<br />
    "python_fu_apply",<br />
    "Apply",<br />
    "This plugin applies a filter to components of a multipart selection",<br />
    "Lloyd Konneker (bootch nc.rr.com)",<br />
    "Copyright 2010 Lloyd Konneker",<br />
    "2010",<br />
    "/Filters/_Apply",<br />
    "*", # image types, !!! TBD But test the filter has compatible image types<br />
    [], # TBD Should be a choice of filters here<br />
    [],<br />
    plugin_main,<br />
    )</p>
<p>if __name__ == "__main__":<br />
    # if invoked from Gimp app as a plugin    print "Starting apply"<br />
    main()</p>
</div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>

<div class="indented"><a id="comment-7797"></a>
<div class="comment even">

  <div class="clearfix">

    <span class="submitted">April 23, 2010 - 21:22 — <span class="username">saulgoode</span></span>

  
  
        <h3><a href="../comment/7797#comment-7797" class="permalink" rel="bookmark">Use code tags, please.</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>It would probably be helpful to wrap your code within "[pre]" and "[/pre]" tags (substitute "&lt;" and "&gt;" for the brackets); this will preserve Python's invisible syntax.</p>
<pre>while not done:
  print "Repeating!"
  do_something()
print "Done!"</pre></div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>

<div class="indented"><a id="comment-7800"></a>
<div class="comment odd">

  <div class="clearfix">

    <span class="submitted">April 24, 2010 - 00:23 — <span class="username">bootchk</span></span>

  
  
        <h3><a href="../comment/7800#comment-7800" class="permalink" rel="bookmark">code tags, thanks</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Sorry, I was in a hurry, didn't preview, didn't know code tags.</p>
<pre>
#!/usr/bin/env python

'''
 Test apply filter to selection parts
 
 Apply a filter to selection parts.
 This might be used when a filter would treat each selection part differently
 because of the content or context of the selection part.
 If a filter output does not depend on the selection,
 e.g. a filter that renders, creates new content, de novo, from scratch ....,
 then don't use this plugin, instead filter the entire selection.
 
 In computer programming 'apply a function' means 'iteratively invoke' on say a list.
 Which is what this does.
 In computer GUI design, an 'Apply' button means 'do it.'
 But for the general public, use the long 'Apply filter to selection parts'
 to say more clearly what will happen.
 
 Test cases:
  doesn't alter existing paths
  doesn't alter the selection
  doesn't alter the context
  doesn't alter layers or channels
'''

'''
Notes about types and terminology.
This can be very confusing.
The below might not be correct:  probably a PDB stroke is a SVG polygon.

These contexts of discussion:
Gimp user
PDB type
SVG
Pygimp type
this program


Gimp    PDB       PDB type  SVG       Pygimp type    this program

Path    vectors   VECTORS   file?     vector object  a set of strokes
NA      strokes   int array NA        tuple          a sequence of stroke items
NA      stroke    int       polyline  int (position) a set of lines
NA      NA        NA        polygon   NA             a closed set of connected lines

'''

from gimpfu import * 

def apply_filter_to_stroke(image, drawable, vectors, stroke):
  ''' 
  For the given stroke of the given vectors, apply filter to a selection made from stroke.
  
  Doesn't appear to be a gimp_vectors_add_stroke().
  There is gimp_vectors_stroke_new_from_points but is only a bezier (for now.)
  So we can't use the strategy: add current stroke to a new vectors.
  (See a draft of that strategy below.)
  
  Instead, we remove all but the current stroke from a copy of vectors.
  '''
  workingvectors = gimp.pdb.gimp_vectors_copy(vectors)
  gimp.pdb.gimp_image_add_vectors(image, workingvectors, -1)
  count, strokes = gimp.pdb.gimp_vectors_get_strokes(workingvectors)
  # Remove all but the given stroke.
  # !!! Note these are stroke positions, we assume they remain constant among copies.
  for strokecopy in strokes:
    if not strokecopy == stroke:
      print "Removing stroke", strokecopy
      gimp.pdb.gimp_vectors_remove_stroke(workingvectors, strokecopy)
  # assert workingvectors now has one stroke
  gimp.pdb.gimp_selection_none(image)
  gimp.pdb.gimp_vectors_to_selection(workingvectors, CHANNEL_OP_ADD, True, True, 2, 2)
  # Apply filter to this component of the original selection
  gimp.pdb.gimp_edit_fill(drawable, FOREGROUND_FILL)
  gimp.pdb.gimp_image_remove_vectors(image, workingvectors)
  
  '''
  This is a draft of another strategy, but nonworking.
  workingvectors = gimp.pdb.gimp_vectors_new(image, 'working')
  gimp.pdb.gimp_image_add_vectors(workingvectors)
  gimp.pdb.gimp_vectors_add_stroke(workingvectors, stroke)
  gimp.pdb.gimp_selection_none(image)
  gimp.pdb.gimp_vectors_to_selection(workingvectors, CHANNEL_OP_ADD, True, True, 2, 2)
  # Apply filter to this component of the original selection
  gimp.pdb.gimp_edit_fill(drawable, FOREGROUND_FILL)
  gimp.pdb.gimp_image_remove_vectors(image, workingvectors)
  '''

  

def plugin_main(image, drawable):
  
  savedselection = gimp.pdb.gimp_selection_save(image) # save the original selection
  
  gimp.pdb.plug_in_sel2path(image, drawable, run_mode=RUN_NONINTERACTIVE)
  # Note the new path is now active, but there might be other paths
  
  '''
  count, vectors = gimp.pdb.gimp_image_get_vectors(image)
  Returns a tuple of integer ID's, not vector objects.
  There is no PDB proc to get a vector object by ID ???
  '''
  
  vectors = gimp.pdb.gimp_image_get_active_vectors(image)
  # print vectors, type(vectors)
  # vectors is a single object.  Not a Python list, not iterable.

  count, strokes = gimp.pdb.gimp_vectors_get_strokes(vectors)
  # strokes is a tuple of items of type "stroke positions" i.e. integers 
  # A stroke is a list of lines, connected in the graph theory sense (shared end points) ??
  # Here, I assume a stroke from a path from a selection is closed in the graph theory sense.
  # TBD test whether any strokes  are NOT closed.
  print "Strokes", strokes, type(strokes)
  for stroke in strokes:
    print stroke, type(stroke)
    apply_filter_to_stroke(image, drawable, vectors, stroke)
  
  # Cleanup
  gimp.pdb.gimp_image_remove_vectors(image, vectors) # Remove path we created from selection
  gimp.pdb.gimp_selection_load(savedselection) # restore the original selection


register(
    "python_fu_apply",
    "Apply",
    "This plugin applies a filter to components of a multipart selection",
    "Lloyd Konneker (bootch nc.rr.com)",
    "Copyright 2010 Lloyd Konneker",
    "2010",
    "/Filters/_Apply",
    "*", # image types, !!! TBD But test the filter has compatible image types
    [], # TBD Should be a choice of filters here
    [],
    plugin_main,
    )
    
if __name__ == "__main__":
    # if invoked from Gimp app as a plugin    print "Starting apply"
    main()




</pre></div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>
</div></div></div><a id="comment-7793"></a>
<div class="comment comment-by-node-author even">

  <div class="clearfix">

    <span class="submitted">April 22, 2010 - 20:01 — <span class="username">lylejk</span></span>

  
  
        <h3><a href="../comment/7793#comment-7793" class="permalink" rel="bookmark">If you disable selection view</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>If you disable selection view (thanks for the tip from RobA), the Script-fu runs even faster.   Maybe Saul will post it here too.  It's works fantastic.  It's like having the Mosaic filter and you can decide the panel design (not limited to Voronoi outline or the few other shapes that it supports).  :)</p>
</div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>
<a id="comment-7803"></a>
<div class="comment comment-by-node-author odd">

  <div class="clearfix">

    <span class="submitted">April 24, 2010 - 08:06 — <span class="username">lylejk</span></span>

  
  
        <h3><a href="../comment/7803#comment-7803" class="permalink" rel="bookmark">Saul updated the Script-fu;</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Saul updated the Script-fu; runs on steroids now.  Hope he posts it here at the Registry.  Really makes fantastic colored mosaics of any type shape for the tiles you can image.  Extremely grateful I am to Saul and many thanks to Rob too.  If only I had half your talents.   :)</p>
</div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>

<div class="indented"><a id="comment-7807"></a>
<div class="comment even">

  <div class="clearfix">

    <span class="submitted">April 24, 2010 - 22:41 — <span class="username">mahvin</span></span>

  
  
        <h3><a href="../comment/7807#comment-7807" class="permalink" rel="bookmark">Wow!</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>On steroids, is the correct way to put it. Works way faster than before. Good job, Saul &amp; Rob A.! Thanks for pointing it out, Lyle.</p>
</div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>
</div><a id="comment-11185"></a>
<div class="comment comment-by-node-author odd">

  <div class="clearfix">

    <span class="submitted">March 28, 2011 - 01:58 — <span class="username">lylejk</span></span>

  
  
        <h3><a href="../comment/11185#comment-11185" class="permalink" rel="bookmark">Hey Saul,
   First, again I</a></h3>
    
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Hey Saul,</p>
<p>   First, again I do appreciate what you did for me on this cool Script.   The big issue is when you have a huge number of islands to fill.   I wonder if there could be a way to speed things up by just selecting the color at the center of the selection island as opposed to getting the average color within a selection island.   Maybe add this as a user option (either average or center color).   Not sure how hard it would be to implement though.   Just wondering.  :)</p>
</div></div></div>          </div>
  </div>

  <ul class="links inline"><li class="comment_forbidden first last"><span><a href="../user/login?destination=comment%252Freply%252F24376%2523comment-form">Log in</a> to post comments</span></li>
</ul></div>

        </div>
  </div>

</div>
  </div>
</div>
  </div>
          </div>
          <a href="../crss/node/24376" class="feed-icon" title="Subscribe to Comments for &quot;How to get average color within a selection island.&quot;"><img src="../misc/feed.png" width="16" height="16" alt="Subscribe to Comments for &quot;How to get average color within a selection island.&quot;" /></a>            <div class="region region-footer">
    <div id="block-block-5" class="block block-block clearfix">

    
  <div class="content">
    Unless otherwise noted, the rights for the individual plugins are with their respective authors. Logo image by Jakub Steiner.
<marquee style="width: 0px; position: absolute"> <a href="http://brazzersdeporno.com" title="porno">porno</a> - <a href="http://www.porno724.com/" target="_blank" title="Porno izle">Porno izle</a> <a href="http://www.yokyokpornolar.com/" target="_blank" title="porno abi">porno abi</a> </marquee>  </div>
</div>
  </div>
      </div></div></div></div> <!-- /.left-corner, /.right-corner, /#squeeze, /#center -->

              <div id="sidebar-second" class="sidebar">
            <div class="region region-sidebar-second">
    <div id="block-search-form" class="block block-search clearfix">

    
  <div class="content">
    <form action="24376" method="post" id="search-block-form" accept-charset="UTF-8"><div><div class="container-inline">
      <h2 class="element-invisible">Search form</h2>
    <div class="form-item form-type-textfield form-item-search-block-form">
  <label class="element-invisible" for="edit-search-block-form--2">Search </label>
 <input title="Enter the terms you wish to search for." type="text" id="edit-search-block-form--2" name="search_block_form" value="" size="15" maxlength="128" class="form-text" />
</div>
<div class="form-actions form-wrapper" id="edit-actions--2"><input type="submit" id="edit-submit--2" name="op" value="Search" class="form-submit" /></div><input type="hidden" name="form_build_id" value="form-i1pkPgsH2CfLP0kmImGeM84L9SnjKIzbgQd3_WfrcWc" />
<input type="hidden" name="form_id" value="search_block_form" />
</div>
</div></form>  </div>
</div>
<div id="block-forum-active" class="block block-forum clearfix">

    <h2 class="title">Active forum topics</h2>
  
  <div class="content">
    <div class="item-list"><ul><li class="first"><a href="32356.html" title="3 comments">Can&#039;t access &quot;My account&quot;</a></li>
<li><a href="32371.html">Delete account</a></li>
<li class="last"><a href="32363.html">Outline</a></li>
</ul></div><div class="more-link"><a href="../forum" title="Read the latest forum topics.">More</a></div>  </div>
</div>
<div id="block-views-newest-questions-block-1" class="block block-views clearfix">

    <h2 class="title">Updated Questions</h2>
  
  <div class="content">
    <div class="view view-newest-questions view-id-newest_questions view-display-id-block_1 view-dom-id-6688f1a43fa3819e49604614fc5df420">
        
  
  
      <div class="view-content">
      <div class="item-list">    <ul>          <li class="views-row views-row-1 views-row-odd views-row-first">  
  <span class="views-field views-field-title">        <span class="field-content"><a href="32373.html">Shadow and Highlights Recovery - Adding group undo</a></span>  </span>  
  <div class="views-field views-field-last-updated">    <span class="views-label views-label-last-updated">Last change</span>    <span class="field-content">3 hours 31 min</span>  </div>  
  <div class="views-field views-field-field-answer-count">        <div class="field-content">No answers, yet!</div>  </div></li>
          <li class="views-row views-row-2 views-row-even">  
  <span class="views-field views-field-title">        <span class="field-content"><a href="32359.html">Does this script work?</a></span>  </span>  
  <div class="views-field views-field-last-updated">    <span class="views-label views-label-last-updated">Last change</span>    <span class="field-content">4 months 2 weeks</span>  </div>  
  <div class="views-field views-field-field-answer-count">        <div class="field-content">No answers, yet!</div>  </div></li>
          <li class="views-row views-row-3 views-row-odd views-row-last">  
  <span class="views-field views-field-title">        <span class="field-content"><a href="32349.html">File upload problem</a></span>  </span>  
  <div class="views-field views-field-last-updated">    <span class="views-label views-label-last-updated">Last change</span>    <span class="field-content">6 months 43 min</span>  </div>  
  <div class="views-field views-field-field-answer-count">        <div class="field-content">1 Answer(s)</div>  </div></li>
      </ul></div>    </div>
  
  
  
      
<div class="more-link">
  <a href="../newest-questions">
    more  </a>
</div>
  
  
  
</div>  </div>
</div>
<div id="block-comment-recent" class="block block-comment clearfix">

    <h2 class="title">Recent comments</h2>
  
  <div class="content">
    <div class="item-list"><ul><li class="first"><a href="../comment/19262#comment-19262">Black triangles</a>&nbsp;<span>2 hours 37 min ago</span></li>
<li><a href="../comment/19261#comment-19261">I use the Python version of</a>&nbsp;<span>4 days 4 hours ago</span></li>
<li class="last"><a href="../comment/19260#comment-19260">I have the same problem too</a>&nbsp;<span>1 week 2 days ago</span></li>
</ul></div>  </div>
</div>
<div id="block-node-recent" class="block block-node clearfix">

    <h2 class="title">Recent content</h2>
  
  <div class="content">
    <table>
<tbody>
 <tr class="odd"><td class="title-author"><div class="node-title"><a href="32373.html">Shadow and Highlights Recovery - Adding group undo</a></div><div class="node-author"><span class="username">programmer_ceds</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="even"><td class="title-author"><div class="node-title"><a href="32360.html">GIMP Plugin Registry in Lockdown mode</a></div><div class="node-author"><span class="username">schumaml</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="odd"><td class="title-author"><div class="node-title"><a href="32372.html">Split to Special PNG&#039;s</a></div><div class="node-author"><span class="username">Efenstor</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="even"><td class="title-author"><div class="node-title"><a href="32371.html">Delete account</a></div><div class="node-author"><span class="username">amarz82</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="odd"><td class="title-author"><div class="node-title"><a href="32370.html">Export with MozJPEG</a></div><div class="node-author"><span class="username">Efenstor</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="even"><td class="title-author"><div class="node-title"><a href="32369.html">Shadow and Highlights Recovery</a></div><div class="node-author"><span class="username">erwinsoo</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="odd"><td class="title-author"><div class="node-title"><a href="27656.html">GIMP Extensions Pack for Windows</a></div><div class="node-author"><span class="username">GIMP Extensions</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="even"><td class="title-author"><div class="node-title"><a href="32341.html">Removed...</a></div><div class="node-author"><span class="username">Le Gnou</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="odd"><td class="title-author"><div class="node-title"><a href="32368.html">ofn-preset-guides</a></div><div class="node-author"><span class="username">Ofnuts</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
 <tr class="even"><td class="title-author"><div class="node-title"><a href="28268.html">Export Layers</a></div><div class="node-author"><span class="username">khalim19</span></div></td><td class="edit"></td><td class="delete"></td> </tr>
</tbody>
</table>
  </div>
</div>
  </div>
        </div>
      
    </div> <!-- /#container -->
  </div> <!-- /#wrapper -->
  </body>
</html>
